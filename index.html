<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin & User Panel</title>
  <style>
    body { font-family: Arial; background: #f4f9f9; padding: 20px; }
    .hidden { display: none; }
    input, button { margin: 5px 0; padding: 5px; }
  </style>
</head>
<body>
  <!-- Đăng nhập -->
  <div id="loginPage">
    <h2>Đăng nhập</h2>
    <input id="loginUsername" placeholder="Tài khoản">
    <input id="loginPassword" type="password" placeholder="Mật khẩu">
    <button onclick="login()">Đăng nhập</button>
    <p>Chưa có tài khoản? <a href="#" onclick="showRegister()">Đăng ký</a></p>
  </div>

  <!-- Đăng ký -->
  <div id="registerPage" class="hidden">
    <h2>Đăng ký</h2>
    <input id="regUsername" placeholder="Tài khoản">
    <input id="regPassword" type="password" placeholder="Mật khẩu">
    <button onclick="register()">Tạo tài khoản</button>
    <p>Đã có tài khoản? <a href="#" onclick="showLogin()">Đăng nhập</a></p>
  </div>

  <!-- Giao diện User -->
  <div id="userPanel" class="hidden">
    <h2>Chào mừng User</h2>
    <p>Nhập Key của bạn</p>
    <input id="userKeyInput" placeholder="Dán key tại đây...">
    <button onclick="checkKey()">Xác nhận</button>
  </div>

  <!-- Giao diện Admin -->
  <div id="adminPanel" class="hidden">
    <h2>Admin Dashboard</h2>
    <p>Tạo Key mới</p>
    <input id="newKeyInput" placeholder="Nhập key...">
    <button onclick="createKey()">Tạo Key</button>
    <h3>Danh sách Key đã tạo</h3>
    <ul id="keyList"></ul>
  </div>

  <script>
    // Lấy users từ localStorage hoặc khởi tạo
    let users = JSON.parse(localStorage.getItem("users")) || [];
    const adminExists = users.some(u => u.username === "admin");
if (!adminExists) {
  users.push({ username: "admin", password: "admin", isAdmin: true });
  localStorage.setItem("users", JSON.stringify(users));
}
    // Đảm bảo luôn có tài khoản admin/admin
   const adminExists = users.some(u => u.username === "admin");
if (!adminExists) {
  users.push({ username: "admin", password: "ducbao123", isAdmin: true });
  localStorage.setItem("users", JSON.stringify(users));
} 

    let keys = JSON.parse(localStorage.getItem("keys")) || [];
    let currentUser = null;

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function saveKeys() {
      localStorage.setItem("keys", JSON.stringify(keys));
    }

    function register() {
      const user = document.getElementById("regUsername").value.trim();
      const pass = document.getElementById("regPassword").value.trim();
      if (!user || !pass) return alert("Vui lòng nhập đủ thông tin!");
      if (users.find(u => u.username === user)) return alert("Tài khoản đã tồn tại!");
      users.push({ username: user, password: pass, isAdmin: false });
      saveUsers();
      alert("Đăng ký thành công!");
      showLogin();
    }

    function login() {
      const user = document.getElementById("loginUsername").value.trim();
      const pass = document.getElementById("loginPassword").value.trim();
      const found = users.find(u => u.username === user && u.password === pass);
      if (!found) return alert("Sai tài khoản hoặc mật khẩu!");
      currentUser = found;
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.add("hidden");
      if (currentUser.isAdmin) {
        document.getElementById("adminPanel").classList.remove("hidden");
        renderKeys();
      } else {
        document.getElementById("userPanel").classList.remove("hidden");
      }
    }

    function showRegister() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.remove("hidden");
    }

    function showLogin() {
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }

    function createKey() {
      const key = document.getElementById("newKeyInput").value.trim();
      if (!key) return alert("Nhập key!");
      if (keys.includes(key)) return alert("Key đã tồn tại!");
      keys.push(key);
      saveKeys();
      document.getElementById("newKeyInput").value = "";
      renderKeys();
    }

    function renderKeys() {
      const list = document.getElementById("keyList");
      list.innerHTML = "";
      keys.forEach(k => {
        const li = document.createElement("li");
        li.textContent = k;
        list.appendChild(li);
      });
    }

    function checkKey() {
      const inputKey = document.getElementById("userKeyInput").value.trim();
      if (keys.includes(inputKey)) {
        alert("Key hợp lệ!");
      } else {
        alert("Key không hợp lệ!");
      }
    }
  </script>
</body>
</html>
